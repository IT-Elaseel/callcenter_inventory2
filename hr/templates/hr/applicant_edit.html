{% extends "orders/base.html" %}
{% block content %}
<style>
  /* ✅ تثبيت الـ Navbar */
  .navbar {
    position: sticky;
    top: 0;
    z-index: 1050; /* يخليها فوق أي عنصر تاني */
  }
</style>
<div class="container py-4">
  <h3 class="mb-3">✏️ تعديل الطلب #{{ applicant.order_number }}</h3>
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    <!-- بيانات مقدم الطلب -->
    <div class="card mb-3">
      <div class="card-header fw-bold">بيانات مقدم الطلب</div>
      <div class="card-body row g-3">
        {{ form.non_field_errors }}
        {% for field in form %}
          {% if field.name in fields_basic %}
            <div class="col-md-4">
              <label class="form-label">{{ field.label }}</label>
              {{ field }}
              <div class="text-danger small">{{ field.errors }}</div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </div>

    <!-- المؤهل الدراسي -->
    <div class="card mb-3">
      <div class="card-header fw-bold">المؤهل الدراسي</div>
      <div class="card-body row g-3">
        {% for field in form %}
          {% if field.name in fields_edu %}
            <div class="col-md-4">
              <label class="form-label">{{ field.label }}</label>
              {{ field }}
              <div class="text-danger small">{{ field.errors }}</div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </div>

    <!-- بيانات الوظيفة والحالة -->
    <div class="card mb-3">
      <div class="card-header fw-bold">بيانات الوظيفة والحالة</div>
      <div class="card-body row g-3">
        {% for field in form %}
          {% if field.name in fields_job %}
            <div class="col-md-6">
              <label class="form-label">{{ field.label }}</label>
              {{ field }}
              <div class="text-danger small">{{ field.errors }}</div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </div>

    <!-- الخبرات السابقة -->
    <div class="card mb-3">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span class="fw-bold">الخبرات السابقة</span>
      </div>
      <div class="card-body">
        {{ formset.management_form }}
        <div class="row g-3">
          {% for f in formset %}
            <div class="col-12 border rounded p-3">
              <div class="row g-3">
                {% for field in f.visible_fields %}
                <div class="col-md-4">
                  <label class="form-label">{{ field.label }}</label>
                  {{ field }}
                  <div class="text-danger small">{{ field.errors }}</div>
                </div>
                {% endfor %}
                {% if f.can_delete %}
                  <div class="col-md-2 d-flex align-items-end">
                    <label class="form-check">
                      {{ f.DELETE }} <span>حذف هذه الخبرة</span>
                    </label>
                  </div>
                {% endif %}
              </div>
              {% for hidden in f.hidden_fields %}{{ hidden }}{% endfor %}
            </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="d-flex gap-2">
      <button class="btn btn-primary">حفظ التعديلات</button>
      <a class="btn btn-secondary" href="{% url 'hr:applicant_detail' applicant.order_number %}">رجوع للتفاصيل</a>
    </div>
  </form>
</div>
{% endblock %}
