{% extends "orders/base.html" %}
{% block content %}
<div class="container py-4">
  <h3 class="mb-3">🗑️ المحذوفات</h3>
  <form class="row g-2 mb-3 align-items-center" id="filter-form">
    <div class="col-md-3 d-flex align-items-center">
      <span class="me-2">من</span>
      <input type="date" id="from-date" name="from" value="{{ filters.from }}"
             class="form-control" max="{{ today }}">
    </div>
    <div class="col-md-3 d-flex align-items-center">
      <span class="me-2">إلى</span>
      <input type="date" id="to-date" name="to" value="{{ filters.to }}"
             class="form-control" max="{{ today }}">
    </div>
    <!-- ❌ شلنا زرار الفلترة -->
  </form>
</div>


  <div class="table-responsive">
    <table class="table table-hover">
      <thead class="table-light">
        <tr>
          <th>#أصلي</th>
          <th>الاسم</th>
          <th>القومي</th>
          <th>الهاتف</th>
          <th>وقت الحذف</th>
          <th>بواسطة</th>
        </tr>
      </thead>
      <tbody>
        {% for d in deleted %}
        <tr>
          <td>#{{ d.original_order_number }}</td>
          <td>{{ d.full_name }}</td>
          <td>{{ d.national_id }}</td>
          <td>{{ d.phone }}</td>
          <td>{{ d.snapshot_at|date:"Y-m-d H:i" }}</td>
          <td>{{ d.deleted_by.get_full_name|default:"-" }}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="text-center text-muted">لا يوجد</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>
  const fromInput = document.getElementById('from-date');
  const toInput = document.getElementById('to-date');
  const form = document.getElementById('filter-form');

  function autoSubmit() {
    let fromDate = fromInput.value;
    let toDate = toInput.value;

    if (fromDate && toDate && fromDate > toDate) {
      // ✅ لو from أكبر من to خليه مساوي لـ from
      toInput.value = fromDate;
      toDate = fromDate;
    }

    form.submit();
  }

  fromInput.addEventListener('change', autoSubmit);
  toInput.addEventListener('change', autoSubmit);
</script>
{% endblock %}
