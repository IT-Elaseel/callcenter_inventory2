{% extends "orders/base.html" %}
{% block title %}ุชุฌููุนุฉ ุทูุจุงุช ุงูุฅูุชุงุฌ{% endblock %}
{% block content %}
<div class="container mt-4" style="max-width: 1000px;">
  <div class="card shadow border-0">
    <div class="card-header bg-primary text-white text-center">
      <h4 class="mb-0">๐ฆ ุชุฌููุนุฉ ุทูุจุงุช ุงูุฅูุชุงุฌ โ {{date}}</h4>
    </div>
    <div class="card-body">

      <!-- ๐ ุงูููุงุชุฑ -->
      <!-- <form method="get" class="row g-2 align-items-center justify-content-center mb-4">
        <div class="col-md-3">
          <label class="form-label mb-1">๐ ุงูุชุงุฑูุฎ:</label>
          <input type="date" name="date" class="form-control" value="{{date}}">
        </div>

        <div class="col-md-4">
          <label class="form-label mb-1">๐ฌ ุงููุฑุน:</label>
          <select name="branch" class="form-select">
            <option value="">ูู ุงููุฑูุน</option>
            {% for b in branches %}
              <option value="{{b.id}}" {% if branch_filter == b.id|stringformat:'s' %}selected{% endif %}>{{b.name}}</option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-3 d-flex align-items-center justify-content-center">
          <input type="checkbox" name="hide_zero" value="1" id="hide_zero" {% if hide_zero %}checked{% endif %}>
          <label for="hide_zero" class="ms-2">ุฅุฎูุงุก ุงูููุชุฌุงุช ุฐุงุช ุงููููุฉ ุตูุฑ</label>
        </div>

        <div class="col-md-2 d-grid">
          <button class="btn btn-primary">ุชุทุจูู</button>
        </div>
      </form> -->
      <form method="get" class="row g-2 align-items-center justify-content-center mb-4">
  <div class="col-md-3">
    <label class="form-label mb-1">๐ ุงูุชุงุฑูุฎ:</label>
    <input type="date" name="date" class="form-control" value="{{date}}">
  </div>

  <div class="col-md-3">
    <label class="form-label mb-1">๐ฌ ุงููุฑุน:</label>
    <select name="branch" class="form-select">
      <option value="">ูู ุงููุฑูุน</option>
      {% for b in branches %}
        <option value="{{b.id}}" {% if branch_filter == b.id|stringformat:'s' %}selected{% endif %}>{{b.name}}</option>
      {% endfor %}
    </select>
  </div>

  <div class="col-md-3">
    <label class="form-label mb-1">๐ ุงููุณู:</label>
    <select name="category" class="form-select">
      <option value="">ูู ุงูุฃูุณุงู</option>
      {% for c in categories %}
        <option value="{{c.id}}" {% if category_filter == c.id|stringformat:'s' %}selected{% endif %}>{{c.name}}</option>
      {% endfor %}
    </select>
  </div>

  <div class="col-md-3 d-flex align-items-center justify-content-center">
    <input type="checkbox" name="hide_zero" value="1" id="hide_zero" {% if hide_zero %}checked{% endif %}>
    <label for="hide_zero" class="ms-2">ุฅุฎูุงุก ุงูููุชุฌุงุช ุฐุงุช ุงููููุฉ ุตูุฑ</label>
  </div>

  <div class="col-md-2 d-grid">
    <button class="btn btn-primary">ุชุทุจูู</button>
  </div>
</form>


      <div class="text-end mb-2">
        <a class="btn btn-success btn-sm"
           href="{% url 'export_production_excel' %}?date={{date}}{% if branch_filter %}&branch={{branch_filter}}{% endif %}{% if category_filter %}&category={{category_filter}}{% endif %}{% if hide_zero %}&hide_zero=1{% endif %}">
          โฌ๏ธ ุชูุฒูู Excel
        </a>
      </div>

      <!-- ๐ ุฌุฏูู -->
      <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle text-center">
          <thead class="table-light">
            <tr>
              <th>ุงูููุชุฌ</th>
              <th>ุงููุญุฏุฉ</th>
              {% if branch_filter %}
                <th>{{branch_name}}</th>
              {% else %}
                {% for b in branches %}<th>{{b.name}}</th>{% endfor %}
              {% endif %}
              <th>ุงูุฅุฌูุงูู</th>
            </tr>
          </thead>
          <tbody>
            {% for r in rows %}
              <tr>
                <td>{{r.product.name}}</td>
                <td>{{r.unit}}</td>
                {% for q in r.per_branch %}
                  <td>{{q}}</td>
                {% endfor %}
                <td class="fw-bold">{{r.total}}</td>
              </tr>
            {% empty %}
              <tr><td colspan="5" class="text-center text-muted">ูุง ุชูุฌุฏ ุจูุงูุงุช.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
