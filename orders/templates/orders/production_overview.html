{% extends "orders/base.html" %}
{% block title %}ØªØ¬Ù…ÙŠØ¹Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬{% endblock %}
{% block content %}
<div class="container mt-4" style="max-width: 1000px;">
  <div class="card shadow border-0">
    <div class="card-header bg-primary text-white text-center">
      <h4 class="mb-0">ğŸ“¦ ØªØ¬Ù…ÙŠØ¹Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ â€” {{date}}</h4>
    </div>
    <div class="card-body">
      <!-- ğŸ¬ Ø­Ø§Ù„Ø© Ø§Ù„ÙØ±ÙˆØ¹ ÙÙŠ ØµÙ ÙˆØ§Ø­Ø¯ -->
  <div class="alert alert-light border mb-4 text-center">
    <h5 class="fw-bold mb-2">ğŸ” Ø­Ø§Ù„Ø© Ø§Ù„ÙØ±ÙˆØ¹:</h5>
    <div style="display: flex; flex-wrap: nowrap; overflow-x: auto; justify-content: center; gap: 25px;">
      {% for b in branch_status %}
        <div style="white-space: nowrap; font-size: 1.1rem;">
          <strong>{{ b.branch.name }}</strong>
          {% if b.done %}
            âœ…
          {% else %}
            âŒ
          {% endif %}
          <small class="text-muted">({{ b.confirmed }}/{{ b.total }})</small>
        </div>
      {% endfor %}
    </div>
  </div>
    <form method="get" class="row g-2 align-items-center justify-content-center mb-4">
      <div class="col-md-3">
        <label class="form-label mb-1">ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
        <input type="date" name="date" class="form-control" value="{{date}}">
      </div>

      <div class="col-md-3">
        <label class="form-label mb-1">ğŸ¬ Ø§Ù„ÙØ±Ø¹:</label>
        <select name="branch" class="form-select">
          <option value="">ÙƒÙ„ Ø§Ù„ÙØ±ÙˆØ¹</option>
          {% for b in branches %}
            <option value="{{b.id}}" {% if branch_filter == b.id|stringformat:'s' %}selected{% endif %}>{{b.name}}</option>
          {% endfor %}
        </select>
      </div>

      <div class="col-md-3">
        <label class="form-label mb-1">ğŸ“‚ Ø§Ù„Ù‚Ø³Ù…:</label>
        <select name="category" class="form-select">
          <option value="">ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>
          {% for c in categories %}
            <option value="{{c.id}}" {% if category_filter == c.id|stringformat:'s' %}selected{% endif %}>{{c.name}}</option>
          {% endfor %}
        </select>
      </div>

      <div class="col-md-3 d-flex align-items-center justify-content-center">
        <input type="hidden" name="hide_zero" value="0">
        <input type="checkbox" name="hide_zero" value="1" id="hide_zero" {% if hide_zero %}checked{% endif %}>
        <label for="hide_zero" class="ms-2">Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø°Ø§Øª Ø§Ù„ÙƒÙ…ÙŠØ© ØµÙØ±</label>
      </div>
    </form>
      <div class="text-end mb-2">
        <a class="btn btn-success btn-sm"
           href="{% url 'export_production_excel' %}?date={{date}}{% if branch_filter %}&branch={{branch_filter}}{% endif %}{% if category_filter %}&category={{category_filter}}{% endif %}{% if hide_zero %}&hide_zero=1{% endif %}">
          â¬‡ï¸ ØªÙ†Ø²ÙŠÙ„ Excel
        </a>
      </div>

      <!-- ğŸ“‹ Ø¬Ø¯ÙˆÙ„ -->
      <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle text-center">
          <thead class="table-light">
            <tr>
              <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
              <th>Ø§Ù„ÙˆØ­Ø¯Ø©</th>
              {% if branch_filter %}
                <th>{{branch_name}}</th>
              {% else %}
                {% for b in branches %}<th>{{b.name}}</th>{% endfor %}
              {% endif %}
              <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
            </tr>
          </thead>
          <tbody>
            {% for r in rows %}
              <tr>
                <td>{{r.product.name}}</td>
                <td>{{r.unit}}</td>
                {% for q in r.per_branch %}
                  <td>{{q}}</td>
                {% endfor %}
                <td class="fw-bold">{{r.total}}</td>
              </tr>
            {% empty %}
              <tr><td colspan="5" class="text-center text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const form = document.querySelector("form");

  // Ø£ÙŠ ØªØºÙŠÙŠØ± ÙÙŠ select Ø£Ùˆ checkbox Ø£Ùˆ input date â†’ ÙŠØ¹Ù…Ù„ submit ØªÙ„Ù‚Ø§Ø¦ÙŠ
  form.querySelectorAll("select, input[type='date'], input[type='checkbox']").forEach(el => {
    el.addEventListener("change", () => {
      form.submit();
    });
  });
});
</script>
{% endblock %}
