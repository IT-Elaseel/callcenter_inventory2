{% extends "orders/base.html" %}
{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2>{{ title }}</h2>

  {% if success %}
    <div class="alert alert-success">âœ… ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ .. Ø³ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§</div>
    <script>
      setTimeout(function() {
        window.location.href = "{% url redirect_url %}";
      }, 2000); // 2 Ø«ÙˆØ§Ù†ÙŠ
    </script>
  {% else %}
    <form method="post">
      {% csrf_token %}
      {{ form.as_p }}
      <button type="submit" class="btn btn-success">ğŸ’¾ Ø­ÙØ¸</button>
      <a href="{% url 'view_data' %}" class="btn btn-secondary">â¬…ï¸ Ø±Ø¬ÙˆØ¹</a>
    </form>
  {% endif %}
</div>
<script>
document.addEventListener("DOMContentLoaded", function() {
  const mainCategory = document.getElementById("mainCategory");
  const subCategory = document.getElementById("subCategory");

  if (mainCategory && subCategory) {
    // ğŸ”¸ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
    mainCategory.addEventListener("change", function() {
      const mainId = this.value;
      subCategory.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ --</option>';
      subCategory.disabled = true; // ÙŠÙ‚ÙÙ„ Ø§Ù„Ø­Ù‚Ù„ Ù…Ø¤Ù‚ØªÙ‹Ø§

      if (mainId) {
        fetch(`/get-subcategories/?main_id=${mainId}`)
          .then(res => res.json())
          .then(data => {
            data.forEach(sub => {
              const option = document.createElement("option");
              option.value = sub.id;
              option.textContent = sub.name;
              subCategory.appendChild(option);
            });
            subCategory.disabled = false; // ÙŠÙØªØ­Ù‡ Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
          })
          .catch(() => {
            subCategory.disabled = false;
          });
      }
    });
  }
});
</script>
{% endblock %}
