{% extends "orders/base.html" %}
{% block title %}Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª{% endblock %}
{% block content %}
<div class="container mt-4">
  <h2>â• Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… / Ù…Ù†ØªØ¬ / ÙØ±Ø¹</h2>
  <div class="mb-3 text-end">
    <a href="{% url 'import_products' %}" class="btn btn-warning">
      ğŸ“¤ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Excel
    </a>
  </div>

  <div class="row">
    <!-- âœ… Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… -->
    <div class="col-md-4">
      <h5>Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù…</h5>
      <form method="post">
        {% csrf_token %}
        {{ cat_form.as_p }}
        <button type="submit" name="add_category" class="btn btn-primary">ğŸ’¾ Ø­ÙØ¸</button>
        {% if success_message and "Ø§Ù„Ù‚Ø³Ù…" in success_message %}
          <div class="alert alert-success mt-2" id="success-msg">{{ success_message }}</div>
        {% endif %}
      </form>
    </div>

    <!-- âœ… Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ -->
    <div class="col-md-4">
      <h5>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h5>
      <form method="post" id="productForm">
        {% csrf_token %}
        {{ prod_form.name.label_tag }} {{ prod_form.name }}
        {{ prod_form.description.label_tag }} {{ prod_form.description }}
        {{ prod_form.price.label_tag }} {{ prod_form.price }}
        {{ prod_form.unit.label_tag }} {{ prod_form.unit }}
        {{ prod_form.category.label_tag }} {{ prod_form.category }}
        {{ prod_form.second_category.label_tag }} {{ prod_form.second_category }}
        {{ prod_form.is_available.label_tag }} {{ prod_form.is_available }}
        <button type="submit" name="add_product" class="btn btn-success mt-2">ğŸ’¾ Ø­ÙØ¸</button>
        {% if success_message and "Ø§Ù„Ù…Ù†ØªØ¬" in success_message %}
          <div class="alert alert-success mt-2" id="success-msg">{{ success_message }}</div>
        {% endif %}
      </form>
    </div>

    <!-- âœ… Ø¥Ø¶Ø§ÙØ© ÙØ±Ø¹ -->
    <div class="col-md-4">
      <h5>Ø¥Ø¶Ø§ÙØ© ÙØ±Ø¹</h5>
      <form method="post">
        {% csrf_token %}
        {{ branch_form.as_p }}
        <button type="submit" name="add_branch" class="btn btn-info">ğŸ’¾ Ø­ÙØ¸</button>
        {% if success_message and "Ø§Ù„ÙØ±Ø¹" in success_message %}
          <div class="alert alert-success mt-2" id="success-msg">{{ success_message }}</div>
        {% endif %}
      </form>
    </div>
  </div>
</div>

<!-- ğŸ”½ JavaScript Ù„Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ -->
<script>
  document.addEventListener("DOMContentLoaded", function() {
    const msg = document.getElementById("success-msg");
    if (msg) {
      setTimeout(() => {
        msg.style.display = "none";
      }, 3000);
    }
  });
// -------------------------------------------------------------------------------------------------------
document.addEventListener("DOMContentLoaded", function() {
  const mainCategory = document.getElementById("mainCategory");
  const subCategory = document.getElementById("subCategory");

  mainCategory?.addEventListener("change", function() {
    const mainId = this.value;
    subCategory.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ --</option>';

    if (mainId) {
      fetch(`/get-subcategories/?main_id=${mainId}`)
        .then(res => res.json())
        .then(data => {
          data.forEach(sub => {
            const option = document.createElement("option");
            option.value = sub.id;
            option.textContent = sub.name;
            subCategory.appendChild(option);
          });
        });
    }
  });
});
</script>
{% endblock %}
