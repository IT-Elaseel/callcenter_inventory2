{% extends "orders/base.html" %}

{% block content %}
<div class="container mt-4">

  <h2 class="mb-4 text-center">ğŸ“ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h2>

  <!-- ğŸŸ¢ ÙÙˆØ±Ù… Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <form method="post" class="row g-3 align-items-end">
        {% csrf_token %}

        <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†ØªØ¬ -->
        <div class="col-md-6">
          <label for="productSelect" class="form-label fw-bold">Ø§Ù„Ù…Ù†ØªØ¬</label>
          <select name="product" id="productSelect" class="form-select" required onchange="updateUnitLabel()">
            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØªØ¬ --</option>
            {% for p in products %}
              <option value="{{ p.id }}" data-unit="{{ p.get_unit_display }}">
                {{ p.name }}
              </option>
            {% endfor %}
          </select>
        </div>

        <!-- Ø§Ù„ÙƒÙ…ÙŠØ© + Ø§Ù„ÙˆØ­Ø¯Ø© -->
        <div class="col-md-4">
          <label class="form-label fw-bold">Ø§Ù„ÙƒÙ…ÙŠØ©</label>
          <div class="input-group">
            <input type="number" name="quantity" min="1" required placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" class="form-control">
            <span id="unitLabel" class="input-group-text bg-light fw-bold text-dark d-none"></span>
          </div>
        </div>

        <!-- Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© -->
        <div class="col-md-2 text-end">
          <button type="submit" name="add_item" class="btn btn-success w-100">â• Ø¥Ø¶Ø§ÙØ©</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ğŸŸ£ Ø§Ù„Ø·Ù„Ø¨ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© -->
  <h3 class="mb-3">ğŸ“‹ Ø§Ù„Ø·Ù„Ø¨ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ø±Ù‚Ù…: <span class="badge bg-primary">{{ order_number }}</span>)</h3>

  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle text-center">
      <thead class="table-dark">
        <tr>
          <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
          <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
          <th>Ø§Ù„ÙˆØ­Ø¯Ø©</th>
          <th>Ø§Ù„ÙˆÙ‚Øª</th>
        </tr>
      </thead>
      <tbody>
        {% for r in requests_today %}
          <tr>
            <td>{{ r.product.name }}</td>
            <td><span class="badge bg-info text-dark">{{ r.quantity }}</span></td>
            <td><span class="badge bg-secondary">{{ r.product.get_unit_display }}</span></td>
            <td>{{ r.created_at|date:"H:i:s" }}</td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="4" class="text-muted">ğŸš« Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- ğŸŸ¡ Ø²Ø± ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ÙŠØ© -->
  {% if requests_today %}
    <form method="post" class="mt-3">
      {% csrf_token %}
      <button type="submit" name="confirm_order" class="btn btn-primary btn-lg">
        âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ÙŠØ©
      </button>
    </form>
  {% endif %}

</div>

<!-- ğŸ”µ Ø³ÙƒØ±ÙŠØ¨Øª Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ­Ø¯Ø© -->
<script>
  function updateUnitLabel() {
    const select = document.getElementById("productSelect");
    const unitLabel = document.getElementById("unitLabel");
    const selectedOption = select.options[select.selectedIndex];
    const unit = selectedOption.getAttribute("data-unit");

    if (unit) {
      unitLabel.textContent = unit;
      unitLabel.classList.remove("d-none");
    } else {
      unitLabel.textContent = "";
      unitLabel.classList.add("d-none");
    }
  }
</script>
{% endblock %}
