{% extends "orders/base.html" %}
{% block title %}Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2>ğŸ“Š Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>

  <!-- ğŸ”½ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù„ÙŠ Ù‡ÙŠØ¸Ù‡Ø± -->
  <form method="get" class="mb-3 d-flex gap-2 align-items-center">
    <label class="form-label">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ø¯ÙˆÙ„:</label>
    <select name="table" class="form-select" style="max-width:200px;" onchange="this.form.submit()">
      <option value="categories" {% if selected_table == "categories" %}selected{% endif %}>Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>
      <option value="products" {% if selected_table == "products" %}selected{% endif %}>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</option>
      <option value="branches" {% if selected_table == "branches" %}selected{% endif %}>Ø§Ù„ÙØ±ÙˆØ¹</option>
    </select>

    <!-- ğŸ” Ù…Ø±Ø¨Ø¹ Ø¨Ø­Ø« Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª -->
    {% if selected_table == "products" %}
      <input type="text" name="q" class="form-control" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬..." value="{{ query|default:'' }}">
      <button type="submit" class="btn btn-primary">Ø¨Ø­Ø«</button>
    {% endif %}
  </form>

  <!-- âœ… Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… -->
  {% if selected_table == "categories" %}
    <h5>Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</h5>
    <table class="table table-striped table-bordered">
      <thead class="table-primary">
        <tr>
          <th>#</th>
          <th>Ø§Ù„Ø§Ø³Ù…</th>
          <th>Ø§Ù„ÙˆØµÙ</th>
          <th>ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± ØªØ¹Ø¯ÙŠÙ„</th>
          <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
        </tr>
      </thead>
      <tbody>
        {% for c in categories %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ c.name }}</td>
            <td>{{ c.description }}</td>
            <td>{{ c.updated_at|date:"Y-m-d H:i" }}</td>
            <td>
              <a href="{% url 'edit_category' c.id %}" class="btn btn-sm btn-warning">âœï¸ ØªØ¹Ø¯ÙŠÙ„</a>
              <form method="post" class="delete-form d-inline">
                {% csrf_token %}
                <input type="hidden" name="delete_category" value="{{ c.id }}">
                <button type="submit" class="btn btn-sm btn-danger">ğŸ—‘ Ø­Ø°Ù</button>
              </form>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="5">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ù…</td></tr>
        {% endfor %}
      </tbody>
    </table>
  {% endif %}

  <!-- âœ… Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
  {% if selected_table == "products" %}
    <h5>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h5>
    <table class="table table-striped table-bordered">
      <thead class="table-success">
        <tr>
          <th>#</th>
          <th>Ø§Ù„Ø§Ø³Ù…</th>
          <th>Ø§Ù„Ù‚Ø³Ù…</th>
          <th>Ø§Ù„Ø³Ø¹Ø±</th>
          <th>Ø§Ù„ÙˆØ­Ø¯Ø©</th>
          <th>ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± ØªØ¹Ø¯ÙŠÙ„</th>
          <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
        </tr>
      </thead>
      <tbody>
        {% for p in products %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ p.name }}</td>
            <td>{{ p.category.name }}</td>
            <td>{{ p.price }}</td>
            <td>{{ p.get_unit_display }}</td>
            <td>{{ p.updated_at|date:"Y-m-d H:i" }}</td>
            <td>
              <a href="{% url 'edit_product' p.id %}" class="btn btn-sm btn-warning">âœï¸ ØªØ¹Ø¯ÙŠÙ„</a>
              <form method="post" class="delete-form d-inline">
                {% csrf_token %}
                <input type="hidden" name="delete_product" value="{{ p.id }}">
                <button type="submit" class="btn btn-sm btn-danger">ğŸ—‘ Ø­Ø°Ù</button>
              </form>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="7">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</td></tr>
        {% endfor %}
      </tbody>
    </table>
  {% endif %}

  <!-- âœ… Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙØ±ÙˆØ¹ -->
  {% if selected_table == "branches" %}
    <h5>Ø§Ù„ÙØ±ÙˆØ¹</h5>
    <table class="table table-striped table-bordered">
      <thead class="table-info">
        <tr>
          <th>#</th>
          <th>Ø§Ù„Ø§Ø³Ù…</th>
          <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
          <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
          <th>ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± ØªØ¹Ø¯ÙŠÙ„</th>
          <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
        </tr>
      </thead>
      <tbody>
        {% for b in branches %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ b.name }}</td>
            <td>{{ b.address }}</td>
            <td>{{ b.phone }}</td>
            <td>{{ b.updated_at|date:"Y-m-d H:i" }}</td>
            <td>
              <a href="{% url 'edit_branch' b.id %}" class="btn btn-sm btn-warning">âœï¸ ØªØ¹Ø¯ÙŠÙ„</a>
              <form method="post" class="delete-form d-inline">
                {% csrf_token %}
                <input type="hidden" name="delete_branch" value="{{ b.id }}">
                <button type="submit" class="btn btn-sm btn-danger">ğŸ—‘ Ø­Ø°Ù</button>
              </form>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="6">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ±ÙˆØ¹</td></tr>
        {% endfor %}
      </tbody>
    </table>
  {% endif %}
</div>

<!-- ğŸ”½ JavaScript -->
<script>
  document.addEventListener("DOMContentLoaded", function() {
    document.querySelectorAll(".delete-form").forEach(form => {
      form.addEventListener("submit", function(e) {
        e.preventDefault(); // âŒ ÙŠÙ…Ù†Ø¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù„Ø³ÙŠØ±ÙØ±

        let row = form.closest("tr");
        row.innerHTML = `<td colspan="${row.cells.length}" class="text-danger fw-bold text-center">âŒ ØªÙ… Ø§Ù„Ø­Ø°Ù</td>`;

        setTimeout(() => {
          row.remove();
        }, 2000);
      });
    });
  });
</script>
{% endblock %}
