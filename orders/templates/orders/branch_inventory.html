{% extends "orders/base.html" %}
{% block title %}📦 المخزون{% endblock %}

{% block content %}
<h2>
  📦 المخزون
  {% if branch %}
    - {{ branch.name }}
  {% elif branches %}
    - كل الفروع
  {% endif %}
</h2>

<!-- 🔽 فلترة الأقسام + البحث + الفروع -->
<form method="get" class="mb-3" id="filterForm">
  <div class="d-flex flex-wrap gap-3 align-items-end">

    {% if branches %}
    <div class="form-group">
      <label class="form-label">الفرع:</label>
      <select name="branch" class="form-select" onchange="this.form.submit()">
        <option value="all" {% if not selected_branch %}selected{% endif %}>-- كل الفروع --</option>
        {% for b in branches %}
          <option value="{{ b.id }}" {% if selected_branch == b.id %}selected{% endif %}>
            {{ b.name }}
          </option>
        {% endfor %}
      </select>
    </div>
    {% endif %}

    <div class="form-group">
      <label class="form-label">القسم:</label>
      <select name="category" class="form-select" onchange="this.form.submit()">
        <option value="">-- كل الأقسام --</option>
        {% for c in categories %}
          <option value="{{ c.id }}" {% if selected_category == c.id %}selected{% endif %}>
            {{ c.name }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="form-group">
      <label class="form-label">بحث:</label>
      <input type="text" class="form-control" name="q" value="{{ query|default:'' }}" placeholder="اسم المنتج">
    </div>

    <div>
      <button type="submit" class="btn btn-primary">عرض</button>
    </div>
  </div>
</form>

<!-- جدول المخزون -->
<div class="table-responsive mt-4">
  <table class="table table-bordered table-striped table-hover text-center align-middle">
    <thead class="table-dark">
      <tr>
        <th style="width:40%;">المنتج</th>
        <th style="width:20%;">القسم</th>
        {% if branches %}<th style="width:20%;">الفرع</th>{% endif %}
        <th style="width:20%;">الكمية المتوفرة</th>
      </tr>
    </thead>
    <tbody>
      {% for inv in inventories %}
      <tr>
        <td class="text-start">{{ inv.product.name }}</td>
        <td>{{ inv.product.category.name }}</td>
        {% if branches %}<td>{{ inv.branch.name }}</td>{% endif %}
        <td>{{ inv.quantity }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="{% if branches %}4{% else %}3{% endif %}" class="text-center">❌ لا توجد منتجات مطابقة.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- ✅ Hover Effect -->
<style>
  .table.table-hover tbody tr:hover > td {
      background-color: #f8d7da !important; /* أحمر فاتح */
      color: #000 !important;              /* النص يفضل واضح */
      transition: background 0.2s ease;
  }


</style>

<script>
  document.querySelector("input[name='q']").addEventListener("keypress", function(e) {
    if (e.key === "Enter") {
      e.preventDefault();
      document.getElementById("filterForm").submit();
    }
  });
</script>
{% endblock %}
