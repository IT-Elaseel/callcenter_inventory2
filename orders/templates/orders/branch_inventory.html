{% extends "orders/base.html" %}
{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">

<h2>
  ğŸ“¦ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
  {% if branch %}
    - {{ branch.name }}
  {% elif branches %}
    - ÙƒÙ„ Ø§Ù„ÙØ±ÙˆØ¹
  {% endif %}
</h2>

<!-- ğŸ”½ ÙÙ„ØªØ±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… + Ø§Ù„Ø¨Ø­Ø« + Ø§Ù„ÙØ±ÙˆØ¹ -->
<form method="get" class="mb-3" id="filterForm">
  <div style="display:flex; gap:15px; align-items:flex-end; flex-wrap:wrap;">

    <!-- âœ… ÙÙ„ØªØ± Ø§Ù„ÙØ±ÙˆØ¹ (Ù„Ù„Ø£Ø¯Ù…Ù† ÙˆØ§Ù„ÙƒÙˆÙ„ Ø³Ù†ØªØ± ÙÙ‚Ø·) -->
    {% if branches %}
    <div class="form-group">
      <label class="form-label">Ø§Ù„ÙØ±Ø¹:</label>
      <select name="branch" class="form-control" onchange="this.form.submit()">
        <option value="all" {% if not selected_branch %}selected{% endif %}>-- ÙƒÙ„ Ø§Ù„ÙØ±ÙˆØ¹ --</option>
        {% for b in branches %}
          <option value="{{ b.id }}" {% if selected_branch == b.id %}selected{% endif %}>
            {{ b.name }}
          </option>
        {% endfor %}
      </select>
    </div>
    {% endif %}

    <!-- ÙÙ„ØªØ± Ø§Ù„Ù‚Ø³Ù… -->
    <div class="form-group">
      <label class="form-label">Ø§Ù„Ù‚Ø³Ù…:</label>
      <select name="category" class="form-control" onchange="this.form.submit()">
        <option value="">-- ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… --</option>
        {% for c in categories %}
          <option value="{{ c.id }}" {% if selected_category == c.id %}selected{% endif %}>
            {{ c.name }}
          </option>
        {% endfor %}
      </select>
    </div>

    <!-- Ø§Ù„Ø¨Ø­Ø« -->
    <div class="form-group">
      <label class="form-label">Ø¨Ø­Ø«:</label>
      <input type="text" class="form-control" name="q" value="{{ query|default:'' }}" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
    </div>

    <div>
      <button type="submit" class="btn btn-primary">Ø¹Ø±Ø¶</button>
    </div>
  </div>
</form>

<!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† -->
<div class="table-responsive mt-4">
  <table class="table table-bordered table-striped">
    <thead class="table-dark">
      <tr>
        <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
        <th>Ø§Ù„Ù‚Ø³Ù…</th>
        {% if branches %}<th>Ø§Ù„ÙØ±Ø¹</th>{% endif %}
        <th>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªÙˆÙØ±Ø©</th>
      </tr>
    </thead>
    <tbody>
      {% for inv in inventories %}
      <tr>
        <td>{{ inv.product.name }}</td>
        <td>{{ inv.product.category.name }}</td>
        {% if branches %}<td>{{ inv.branch.name }}</td>{% endif %}
        <td>{{ inv.quantity }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="{% if branches %}4{% else %}3{% endif %}" class="text-center">âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø©.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
  // âœ… Ù„Ù…Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¶ØºØ· Enter ÙÙ‰ Ø§Ù„Ø¨Ø­Ø« â†’ Ø§Ù„ÙÙˆØ±Ù… ÙŠØªØ¨Ø¹Øª
  document.querySelector("input[name='q']").addEventListener("keypress", function(e) {
    if (e.key === "Enter") {
      e.preventDefault();
      document.getElementById("filterForm").submit();
    }
  });
</script>

{% endblock %}
