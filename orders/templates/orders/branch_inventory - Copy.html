{% extends "orders/base.html" %}
{% block title %}ğŸ“¦ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†{% endblock %}

{% block content %}
<div class="inventory-dashboard">

    <!-- âœ… Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ø¨Øª -->
    <div class="header-fixed">
        <h2 class="page-title">
          ğŸ“¦ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
          {% if branch %}
            - {{ branch.name }}
          {% elif branches %}
            - ÙƒÙ„ Ø§Ù„ÙØ±ÙˆØ¹
          {% endif %}
        </h2>

        <!-- ğŸ”½ ÙÙ„ØªØ±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… + Ø§Ù„Ø¨Ø­Ø« + Ø§Ù„ÙØ±ÙˆØ¹ -->
        <form method="get" id="filterForm" class="filters">
          <div class="d-flex flex-wrap gap-3 align-items-end">

            {% if branches %}
            <div class="form-group">
              <label class="form-label">Ø§Ù„ÙØ±Ø¹:</label>
              <select name="branch" class="form-select" onchange="this.form.submit()">
                <option value="all" {% if not selected_branch %}selected{% endif %}>-- ÙƒÙ„ Ø§Ù„ÙØ±ÙˆØ¹ --</option>
                {% for b in branches %}
                  <option value="{{ b.id }}" {% if selected_branch == b.id %}selected{% endif %}>
                    {{ b.name }}
                  </option>
                {% endfor %}
              </select>
            </div>
            {% endif %}

            <div class="form-group">
              <label class="form-label">Ø§Ù„Ù‚Ø³Ù…:</label>
              <select name="category" class="form-select" onchange="this.form.submit()">
                <option value="">-- ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… --</option>
                {% for c in categories %}
                  <option value="{{ c.id }}" {% if selected_category == c.id %}selected{% endif %}>
                    {{ c.name }}
                  </option>
                {% endfor %}
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Ø¨Ø­Ø«:</label>
              <input type="text" class="form-control" name="q" value="{{ query|default:'' }}" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
            </div>

            <div>
              <button type="submit" class="btn btn-primary">Ø¹Ø±Ø¶</button>
            </div>
          </div>
        </form>
    </div>

    <!-- âœ… Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
    <div class="table-wrapper">
      <table class="styled-table">
        <thead>
          <tr>
            <th style="width:40%;">Ø§Ù„Ù…Ù†ØªØ¬</th>
            <th style="width:20%;">Ø§Ù„Ù‚Ø³Ù…</th>
            {% if branches %}<th style="width:20%;">Ø§Ù„ÙØ±Ø¹</th>{% endif %}
            <th style="width:20%;">Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªÙˆÙØ±Ø©</th>
          </tr>
        </thead>
        <tbody>
          {% for inv in inventories %}
          <tr>
            <td class="text-start">{{ inv.product.name }}</td>
            <td>{{ inv.product.category.name }}</td>
            {% if branches %}<td>{{ inv.branch.name }}</td>{% endif %}
            <td>{{ inv.quantity }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="{% if branches %}4{% else %}3{% endif %}" class="text-center">âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø©.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
</div>

<style>
  html, body {
      height: 100%;
      margin: 0;
      overflow: hidden; /* ÙŠÙ…Ù†Ø¹ Scroll Ø®Ø§Ø±Ø¬ÙŠ */
  }

  .inventory-dashboard {
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
  }

  .header-fixed {
      position: sticky;
      top: 0;
      background: #fff;
      z-index: 20;
      padding-bottom: 10px;
      border-bottom: 2px solid #ddd;
  }

  .page-title { font-size:24px; margin-bottom:15px; color:#222; font-weight:700; }

  .filters { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px; }

  .table-wrapper {
      flex: 1 1 auto;
      overflow-y: auto;
      border:1px solid #ddd;
      border-radius:8px;
  }

  .styled-table { width:100%; border-collapse:collapse; font-size:15px; }
  .styled-table th, .styled-table td { padding:12px; text-align:center; border:1px solid #eee; }
  .styled-table th {
    position: sticky;
    top: 0;
    background: #000;   /* Ø®Ù„ÙÙŠØ© Ø³ÙˆØ¯Ø§Ø¡ */
    color: #fff;        /* Ø§Ù„Ø®Ø· Ø£Ø¨ÙŠØ¶ */
    font-weight: bold;  /* ÙŠØ®Ù„ÙŠ Ø§Ù„Ø®Ø· Bold */
    z-index: 5;
    font-size: 16px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  }

  /* Hover Effect */
  .styled-table tbody tr:hover > td {
      background-color: #f8d7da !important;
      color: #000 !important;
      transition: background 0.2s ease;
  }
</style>

<script>
  document.querySelector("input[name='q']").addEventListener("keypress", function(e) {
    if (e.key === "Enter") {
      e.preventDefault();
      document.getElementById("filterForm").submit();
    }
  });
</script>
{% endblock %}
